# Generated by control-plane. Manual edits will be overwritten.

http_port {{ listen_port }}
pid_filename /var/run/squid/squid.pid
coredump_dir /var/spool/squid

cache deny all

logformat waf_forward_proxy %ts.%03tu %>a %rm %ru %>Hs %<st
access_log stdio:/var/log/squid/access.log waf_forward_proxy

acl CONNECT method CONNECT
acl SSL_ports port {{ connect_ports | join(' ') }}
acl Safe_ports port 80 443 563 70 210 280 488 591 777 1025-65535

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

{% if client_cidrs %}
acl allowed_clients src {{ client_cidrs | join(' ') }}
http_access deny !allowed_clients
{% endif %}

{% for rule in deny_rules %}
acl {{ rule.acl_name }} {{ rule.acl_type }} {{ rule.value }}
http_access deny {{ rule.acl_name }}
{% endfor %}

{% for rule in allow_rules %}
acl {{ rule.acl_name }} {{ rule.acl_type }} {{ rule.value }}
http_access allow {{ rule.acl_name }}
{% endfor %}

http_access {{ default_action }} all
